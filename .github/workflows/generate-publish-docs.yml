name: Generate and publish documentation

on:
  push:
    branches:
      - main

jobs:
  documentation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repo
        uses: actions/checkout@v3
      - name: Generate Doxygen documentation
        uses: mattnotmitt/doxygen-action@v1.9.5
        with:
          working-directory: 'docs/doxygen'
      - name: Install Doxygen (for exhale)
        run: sudo apt-get update && sudo apt-get install -y doxygen
      - name: Add Doxygen to PATH
        run: echo "/usr/bin" >> $GITHUB_PATH
      - name: Check Doxygen Installation
        run: doxygen --version
      - name: Install Python dependencies
        run: pip install -r docs/requirements.txt
      - name: Print working directory
        run: pwd
      - name: Process the Doxygen output using Sphinx
        run: sphinx-build -b html docs docs/sphinx
      - name: Deploy to Github pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs/sphinx
